{
  "project": "RIVET Pro",
  "branchName": "ralph/mvp-phase1",
  "description": "Phase 1 MVP - Usage tracking, Stripe payment, freemium limits, and optimizations",
  "userStories": [
    {
      "id": "RIVET-001",
      "title": "Usage Tracking System",
      "description": "Track equipment lookups per user for freemium enforcement. Each photo upload counts as one lookup. Store user_id and timestamp to enforce 10 free lookups per user.",
      "acceptanceCriteria": [
        "Create usage_tracking table in Supabase with columns: id, user_id, telegram_user_id, lookup_timestamp, equipment_id",
        "Add get_usage_count(telegram_user_id) function that returns count of lookups",
        "Modify rivet_pro/bot/ photo handler to record each lookup",
        "Block users at 10 lookups with upgrade message",
        "Test with local bot - send 10 photos, verify 11th is blocked",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented usage_tracking table, UsageService with get_usage_count(), check_limit(), can_use_service(). Photo handler now checks limits before processing and records lookups after success. Free users blocked at 10 lookups with upgrade message."
    },
    {
      "id": "RIVET-002",
      "title": "Stripe Payment Integration",
      "description": "Connect Stripe for Pro tier at $29/month. Create checkout flow and handle webhooks to upgrade users.",
      "acceptanceCriteria": [
        "Create Stripe product and price for 'RIVET Pro' at $29/month",
        "Add create_checkout_session endpoint in rivet_pro/api/",
        "Implement Stripe webhook handler for payment success",
        "Update users table with subscription_status and stripe_customer_id columns",
        "Send Telegram confirmation on successful payment",
        "Test with Stripe test mode - verify checkout and webhook",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented StripeService with checkout session creation, webhook handler for subscription events. Added /upgrade command to bot. Created migration 012_stripe_integration.sql for subscription_status and stripe_customer_id columns. Webhook endpoint at /api/stripe/webhook."
    },
    {
      "id": "RIVET-003",
      "title": "Free Tier Limit Enforcement",
      "description": "Block lookups at 10 for free users and show upgrade prompt with Stripe link. Pro users get unlimited lookups.",
      "acceptanceCriteria": [
        "Check subscription_status before processing photo",
        "Return upgrade message with Stripe checkout link if limit hit and user is free",
        "Allow Pro users (subscription_status='active') unlimited lookups",
        "Upgrade message includes clear pricing and benefits",
        "Test both free and pro user flows",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "RIVET-004",
      "title": "Shorten System Prompts",
      "description": "Cut all RIVET prompts by 50% for faster field responses. Field techs need FAST responses - reduce token usage without losing quality.",
      "acceptanceCriteria": [
        "Audit all prompts in rivet_pro/ (search for 'prompt' and 'system_message')",
        "Reduce each prompt by at least 50% word count",
        "Remove filler text and verbose explanations",
        "Keep essential technical instructions",
        "Test with sample equipment photos - verify quality maintained",
        "Measure token reduction (log before/after)",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "RIVET-005",
      "title": "Remove n8n Footer",
      "description": "Remove n8n branding from Telegram bot messages. Users should see clean RIVET-branded responses.",
      "acceptanceCriteria": [
        "Find where n8n footer is added to Telegram messages",
        "Remove or override the footer text",
        "Test all message types (equipment info, work orders, errors)",
        "Verify no 'Powered by n8n' or similar branding appears",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    }
  ]
}
