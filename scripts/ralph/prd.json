{
  "project": "RIVET Pro",
  "branchName": "ralph/analytics-phase5",
  "description": "Phase 5: Analytics Dashboard - Build admin analytics for usage tracking, knowledge base health, and SME chat metrics. Telegram-first with /stats and /report commands.",
  "userStories": [
    {
      "id": "ANALYTICS-001",
      "title": "Daily Usage Statistics Aggregation",
      "description": "Create a background job that aggregates daily usage stats from rivet_usage_log into daily_stats table. Track: total queries, unique users, queries by category (equipment/troubleshooting/manual/sme_chat), average response time.",
      "acceptanceCriteria": [
        "Function aggregate_daily_stats() created in rivet_pro/core/services/analytics_service.py",
        "Queries rivet_usage_log for previous day's data",
        "Inserts aggregated row into daily_stats table",
        "Handles duplicate runs gracefully (upsert)",
        "Can be triggered manually or via scheduler"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Commit 9520678 - AnalyticsService with aggregate_daily_stats(), get_today_stats(), format_stats_message()"
    },
    {
      "id": "ANALYTICS-002",
      "title": "Knowledge Base Health Metrics",
      "description": "Track KB health: total atoms, atoms by manufacturer, coverage gaps (queries with no KB matches), stale atoms (not accessed in 30+ days).",
      "acceptanceCriteria": [
        "Function get_kb_health() returns structured health metrics",
        "Counts atoms by manufacturer from knowledge_atoms table",
        "Identifies coverage gaps from low-confidence responses",
        "Tracks atom freshness (last_accessed timestamp)",
        "Returns actionable insights (e.g., 'Siemens coverage: 85%')"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Commit 9520678 - get_kb_health() returns KBHealthMetrics dataclass"
    },
    {
      "id": "ANALYTICS-003",
      "title": "SME Chat Analytics",
      "description": "Track SME chat usage: sessions by vendor, average turns per session, confidence distribution, safety warnings triggered.",
      "acceptanceCriteria": [
        "Function get_sme_chat_analytics() returns chat metrics",
        "Queries sme_chat_sessions and sme_chat_messages tables",
        "Groups by vendor (Siemens, Rockwell, ABB, etc.)",
        "Calculates avg messages per session",
        "Tracks confidence level distribution (HIGH/MEDIUM/LOW)"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Commit 9520678 - get_sme_chat_analytics() returns SMEChatMetrics dataclass"
    },
    {
      "id": "ANALYTICS-004",
      "title": "Admin /stats Command",
      "description": "Create /stats command for admin users showing quick stats: today's queries, active users, top equipment lookups, KB health summary.",
      "acceptanceCriteria": [
        "/stats command added to bot.py",
        "Only accessible to admin users (telegram_id in admin list)",
        "Shows: queries today, unique users today, top 5 equipment",
        "Shows: KB atom count, SME sessions today",
        "Fast response (<2s) using pre-aggregated data"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "ANALYTICS-005",
      "title": "Weekly Report Generation",
      "description": "Generate weekly report summarizing: usage trends, top queries, knowledge gaps, SME chat patterns. Send to admin via Telegram.",
      "acceptanceCriteria": [
        "Function generate_weekly_report() creates formatted report",
        "Compares this week vs last week (trend arrows)",
        "Lists top 10 unanswered queries (knowledge gaps)",
        "Shows SME vendor popularity ranking",
        "Can be triggered via /report command or scheduler"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Commit 9520678 - generate_weekly_report() with trend comparison"
    },
    {
      "id": "ANALYTICS-006",
      "title": "Response Time Tracking",
      "description": "Add response time tracking to all bot interactions. Store in rivet_usage_log with millisecond precision.",
      "acceptanceCriteria": [
        "response_time_ms column added to rivet_usage_log (if not exists)",
        "All message handlers track start/end time",
        "Response time logged with each interaction",
        "Average response time visible in /stats",
        "Slow queries (>5s) flagged for review"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    }
  ]
}
