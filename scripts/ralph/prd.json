{
  "project": {
    "name": "Shop Floor Expert",
    "description": "Production-Grade NLP Assistant for Industrial Maintenance",
    "version": "1.0.0",
    "target": "Pass 97%+ of expert-level queries with <200ms perceived latency"
  },
  "current_state": {
    "basic_test_pass_rate": "100% (26/26)",
    "expert_test_pass_rate": "87.9% (29/33)",
    "response_latency": "500-800ms (wait for full)",
    "llm_calls": "100% of queries",
    "context_awareness": "None"
  },
  "target_state": {
    "basic_test_pass_rate": "100% (26/26)",
    "expert_test_pass_rate": "97%+ (32/33)",
    "response_latency": "<200ms (streaming)",
    "llm_calls": "~15% (fallback only)",
    "context_awareness": "Equipment history injected"
  },
  "phases": [
    {
      "phase": 1,
      "name": "Intent Fixes",
      "stories": ["EXPERT-001", "EXPERT-002", "EXPERT-003"],
      "verification": "python scripts/test_bot_direct.py && python scripts/test_expert_queries.py"
    },
    {
      "phase": 2,
      "name": "Streaming",
      "stories": ["EXPERT-004"],
      "verification": "Send 'motor is overheating' via Telegram, verify first words appear within 200ms"
    },
    {
      "phase": 3,
      "name": "Multi-Signal Router",
      "stories": ["EXPERT-005"],
      "verification": "python scripts/test_expert_queries.py - check logs for LLM call reduction"
    },
    {
      "phase": 4,
      "name": "Context & Polish",
      "stories": ["EXPERT-006", "EXPERT-007", "EXPERT-008"],
      "verification": "Live test with expert queries in Telegram"
    }
  ],
  "stories": [
    {
      "id": "EXPERT-001",
      "title": "Intent Fix: Symptom Questions",
      "description": "Add symptom word override to quick classifier so questions like 'what does a bad motor smell like?' route to TROUBLESHOOT",
      "priority": 1,
      "points": 2,
      "acceptance_criteria": [
        "'what does a bad motor smell like?' → TROUBLESHOOT (0.85+)",
        "'what does a failing bearing sound like?' → TROUBLESHOOT (0.85+)",
        "Symptom words (smell, sound, feel, look) + bad/failing → TROUBLESHOOT override",
        "Basic tests still pass 100%"
      ],
      "files_to_modify": [
        "rivet_pro/core/intelligence/intent_classifier.py"
      ],
      "technical_notes": "Add symptom override BEFORE manual pattern check in _quick_classify() method, lines 195-280"
    },
    {
      "id": "EXPERT-002",
      "title": "Intent Fix: Logging Patterns",
      "description": "Add logging patterns (log this, log it, document this, record this) to quick classifier for WORK_ORDER_CREATE",
      "priority": 2,
      "points": 2,
      "acceptance_criteria": [
        "'log this: changed belts on AHU-5' → WORK_ORDER_CREATE (0.90+)",
        "'log it: replaced filter' → WORK_ORDER_CREATE (0.90+)",
        "'document this: compressor startup' → WORK_ORDER_CREATE (0.90+)",
        "'record this: cleaned contacts' → WORK_ORDER_CREATE (0.90+)",
        "Basic tests still pass 100%"
      ],
      "files_to_modify": [
        "rivet_pro/core/intelligence/intent_classifier.py"
      ],
      "technical_notes": "Add logging patterns to WO section in _quick_classify()"
    },
    {
      "id": "EXPERT-003",
      "title": "Intent Fix: History Lookup",
      "description": "Add history patterns (fault history, history on, records for) to quick classifier for EQUIPMENT_SEARCH",
      "priority": 3,
      "points": 2,
      "acceptance_criteria": [
        "'VFD fault history' → EQUIPMENT_SEARCH (0.85+)",
        "'history on motor 7' → EQUIPMENT_SEARCH (0.85+)",
        "'fault records for compressor' → EQUIPMENT_SEARCH (0.85+)",
        "Basic tests still pass 100%"
      ],
      "files_to_modify": [
        "rivet_pro/core/intelligence/intent_classifier.py"
      ],
      "technical_notes": "Add history patterns to equipment search section in _quick_classify()"
    },
    {
      "id": "EXPERT-004",
      "title": "Streaming Responses",
      "description": "Implement streaming responses so text appears word-by-word in Telegram instead of waiting for full response",
      "priority": 4,
      "points": 5,
      "acceptance_criteria": [
        "First token appears within 200ms of sending message",
        "Response streams into Telegram chat progressively",
        "Edit message every ~500ms with accumulated tokens (avoid API spam)",
        "Final message shows complete response",
        "Works for TROUBLESHOOT, MANUAL_QUESTION, GENERAL_CHAT intents",
        "Graceful fallback if streaming fails"
      ],
      "files_to_modify": [
        "rivet_pro/adapters/telegram/bot.py"
      ],
      "technical_notes": "Use stream=True in Groq/OpenAI calls, accumulate tokens, edit Telegram message periodically"
    },
    {
      "id": "EXPERT-005",
      "title": "Multi-Signal Router",
      "description": "Replace single classifier with 3-signal voting: keyword (40%) + semantic (35%) + LLM fallback (25%)",
      "priority": 5,
      "points": 8,
      "acceptance_criteria": [
        "Keyword signal: pattern matching (0ms, 85% accuracy)",
        "Semantic signal: embedding similarity (10ms, 88% accuracy)",
        "LLM signal: only called when confidence < 0.75 (50ms, 95% accuracy)",
        "Weighted voting: keyword 40%, semantic 35%, LLM 25%",
        "Final confidence = weighted average of signals",
        "LLM called for only ~15% of queries (high-confidence skip)",
        "Expert test pass rate >= 95%"
      ],
      "files_to_create": [
        "rivet_pro/core/intelligence/multi_signal_router.py"
      ],
      "technical_notes": "Cache intent embeddings at startup, use cosine similarity for semantic matching"
    },
    {
      "id": "EXPERT-006",
      "title": "Context Retrieval",
      "description": "Search equipment history before generating responses, inject relevant past cases into prompt",
      "priority": 6,
      "points": 5,
      "acceptance_criteria": [
        "Before generating response, search equipment history for similar issues",
        "Inject top 3 relevant past cases into system prompt",
        "Response naturally references relevant history when applicable",
        "If no relevant history, respond normally (no awkward 'no history found')",
        "Works for TROUBLESHOOT and EQUIPMENT_SEARCH intents"
      ],
      "files_to_create": [
        "rivet_pro/core/intelligence/context_retriever.py"
      ],
      "technical_notes": "Search equipment table and work order history, limit to 500 tokens of context"
    },
    {
      "id": "EXPERT-007",
      "title": "Voice-First Optimization",
      "description": "Clean up speech-to-text artifacts: filler words, abbreviation normalization, incomplete sentences",
      "priority": 7,
      "points": 3,
      "acceptance_criteria": [
        "Strip filler words: 'uh', 'um', 'like', 'you know', 'basically'",
        "Normalize industry abbreviations: 'vee eff dee' → 'VFD', 'ay ach you' → 'AHU'",
        "Handle incomplete sentences: 'motor... pump 3... not working' → coherent query",
        "Preserve technical terms: 'megger', 'FLA', 'phase imbalance'",
        "Add common speech-to-text errors to pattern matching"
      ],
      "files_to_create": [
        "rivet_pro/core/intelligence/voice_normalizer.py"
      ],
      "technical_notes": "Run normalization BEFORE intent classification, build abbreviation dictionary"
    },
    {
      "id": "EXPERT-008",
      "title": "Expert Response Templates",
      "description": "Update system prompts to respect technician expertise - direct answers, no condescending explanations",
      "priority": 8,
      "points": 3,
      "acceptance_criteria": [
        "Troubleshoot responses: Jump to diagnosis, not basics",
        "Manual responses: Give specs/procedures directly, skip preamble",
        "Work order responses: Confirm and move on, don't over-explain",
        "Detect technical terminology in query → assume expert level",
        "No condescending phrases: 'As you may know...', 'For safety...'"
      ],
      "files_to_create": [
        "rivet_pro/core/intelligence/response_templates.py"
      ],
      "technical_notes": "Add technical term detection to set 'expert mode'"
    }
  ],
  "success_metrics": {
    "expert_test_pass_rate": ">=97% (32/33)",
    "basic_test_pass_rate": "100% (26/26)",
    "first_token_latency": "<200ms",
    "llm_call_reduction": ">=80% (fallback only)",
    "user_satisfaction": "'This actually helps' from 20-year tech"
  }
}
