{
  "project": "RIVET Pro",
  "branchName": "ralph/tech-debt-cleanup",
  "description": "Technical Debt Cleanup Sprint: Address critical technical debt before Phase 5 features. Focus on runtime stability issues including hardcoded configuration, in-memory state that doesn't survive restarts, unimplemented database queries, and silent error handling.",
  "userStories": [
    {
      "id": "DEBT-001",
      "title": "Extract Hardcoded Chat ID to Configuration",
      "description": "The chat ID 8445149012 is hardcoded in 6+ locations. Extract to settings.py as ADMIN_CHAT_ID.",
      "acceptanceCriteria": [
        "No hardcoded chat IDs remain in codebase (grep returns 0 results)",
        "ADMIN_CHAT_ID added to rivet_pro/config/settings.py",
        "All 6 files updated to use settings.ADMIN_CHAT_ID",
        ".env.example documents the ADMIN_CHAT_ID setting",
        "Bot starts and works correctly with config value"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Commit d17ba61 - Extracted to settings.telegram_admin_chat_id"
    },
    {
      "id": "DEBT-002",
      "title": "Implement Persistent Node Callback Storage",
      "description": "Node callback mappings stored in memory are lost on restart. Implement PostgreSQL persistence.",
      "acceptanceCriteria": [
        "Migration 027_node_callback_mappings.sql created and applied",
        "callback.py uses PostgreSQL instead of in-memory dict",
        "Callbacks persist across bot restarts",
        "Expired mappings (>24h) are automatically cleaned up",
        "No memory leak from accumulating mappings",
        "Troubleshooting tree navigation works after restart"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Commit 497c23d - PostgreSQL storage with 24h TTL and in-memory cache"
    },
    {
      "id": "DEBT-003",
      "title": "Implement Troubleshooting Tree Database Query",
      "description": "The _query_cached_trees() and _load_tree_from_db() functions have TODO comments and aren't implemented, causing expensive Claude API fallback.",
      "acceptanceCriteria": [
        "_query_cached_trees() implemented with real database query",
        "_load_tree_from_db() implemented with full tree retrieval",
        "In-memory TTL cache (5 min) reduces database queries",
        "Falls back to Claude only when no cached tree exists",
        "Claude API calls measurably reduced for repeat queries",
        "Existing tests still pass"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Commit 8d0b555 - DB query with fuzzy matching and 5-min cache"
    },
    {
      "id": "DEBT-004",
      "title": "Replace Silent Error Handling with Proper Logging",
      "description": "17 instances of bare 'except: pass' silently swallow errors, making debugging impossible.",
      "acceptanceCriteria": [
        "No bare except: pass remains in codebase",
        "All 5 files updated with proper exception handling",
        "Each caught exception is logged with context",
        "Critical exceptions (CancelledError, SystemExit) are re-raised",
        "grep -rn 'except.*:.*pass' rivet_pro/ returns 0 results",
        "Bot operates normally with new error handling",
        "Errors now visible in logs for debugging"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Commit fc51ef8 - Replaced 3 remaining bare except:pass with proper logging"
    }
  ]
}
